<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RG Support</title>

<style>
body {
  font-family: sans-serif;
  padding: 20px;
  font-size: 1.6rem;
  text-align: center;
}

h1 { font-size: 2.4rem; }

input, button {
  font-size: 1.6rem;
  padding: 12px;
  margin: 10px;
}

button { border-radius: 12px; }

ul { list-style: none; padding: 0; }
li { margin: 10px 0; }

#settingsScreen { display: none; }

.container {
  max-width: 650px;
  margin: auto;
}
</style>
</head>

<body>

<div class="container">

<h1>RG Support</h1>

<div id="mainScreen">

<h2>Target Value</h2>
<input type="number" id="target" step="0.001" min="0" max="1000">

<h2>Tolerance</h2>
<input type="number" id="tolerance" step="0.001" min="0" value="0">

<br>
<button onclick="calculate()">Calculate</button>
<button onclick="openSettings()">Settings</button>

<h2>Result</h2>
<div id="result"></div>

</div>

<div id="settingsScreen">

<h2>Number Settings</h2>

<input type="number" id="newNumber" step="0.001" min="0" max="1000">
<br>
<button onclick="addNumber()">Add</button>
<button onclick="sortNumbers()">Sort</button>
<button onclick="closeSettings()">Back</button>

<ul id="numberList"></ul>

</div>

</div>

<script>

let numbers = JSON.parse(localStorage.getItem("numbers")) || [
  {value:1, enabled:true},
  {value:5, enabled:true},
  {value:10, enabled:true}
];

function save() {
  localStorage.setItem("numbers", JSON.stringify(numbers));
  render();
}

function render() {
  let list = document.getElementById("numberList");
  list.innerHTML = "";

  numbers.forEach((n,i)=>{
    list.innerHTML += `
      <li>
        <input type="checkbox" ${n.enabled ? "checked" : ""}
          onchange="toggleNumber(${i})">
        ${n.value}
        <button onclick="removeNumber(${i})">Delete</button>
      </li>`;
  });
}

function addNumber() {
  let val = parseFloat(document.getElementById("newNumber").value);
  if (!isNaN(val) && val > 0 && val <= 1000) {
    numbers.push({value:val, enabled:true});
    save();
    document.getElementById("newNumber").value = "";
  }
}

function removeNumber(i) {
  numbers.splice(i,1);
  save();
}

function toggleNumber(i) {
  numbers[i].enabled = !numbers[i].enabled;
  save();
}

function sortNumbers() {
  numbers.sort((a,b)=>b.value-a.value);
  save();
}

function calculate() {

  let target = parseFloat(document.getElementById("target").value);
  let tolerance = parseFloat(document.getElementById("tolerance").value) || 0;

  if (isNaN(target)) return;

  let active = numbers
    .filter(n=>n.enabled)
    .map(n=>Math.round(n.value*1000));

  target = Math.round(target*1000);
  tolerance = Math.round(tolerance*1000);

  let best = null;

  function backtrack(start, sum, combo) {

    if (sum > target + tolerance) return;

    let diff = Math.abs(target - sum);
    if (diff <= tolerance) {
      if (best === null || combo.length < best.length) {
        best = [...combo];
      }
    }

    for (let i = start; i < active.length; i++) {
      combo.push(active[i]);
      backtrack(i + 1, sum + active[i], combo);
      combo.pop();
    }
  }

  backtrack(0, 0, []);

  if (!best) {
    document.getElementById("result").innerText =
      "No combination found.";
    return;
  }

  let sum = best.reduce((a,b)=>a+b,0);
  let diff = Math.abs(target - sum);

  let resultText =
    best.map(n=> (n/1000).toFixed(3)).join(" + ")
    + " = " + (sum/1000).toFixed(3)
    + " (Used: " + best.length + ")"
    + " (Diff: " + (diff/1000).toFixed(3) + ")";

  document.getElementById("result").innerText = resultText;
}

function openSettings() {
  document.getElementById("mainScreen").style.display = "none";
  document.getElementById("settingsScreen").style.display = "block";
}

function closeSettings() {
  document.getElementById("settingsScreen").style.display = "none";
  document.getElementById("mainScreen").style.display = "block";
}

render();

</script>

</body>
</html>
